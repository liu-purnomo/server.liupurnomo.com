# Contributing Guide

Thank you for your interest in contributing to Liu Purnomo Blog API! This guide will help you understand our workflow and conventions.

## Table of Contents

- [Code of Conduct](#code-of-conduct)
- [Getting Started](#getting-started)
- [Development Workflow](#development-workflow)
- [Commit Convention](#commit-convention)
- [Deployment Checklist](#deployment-checklist)
- [Version Management](#version-management)

---

## Code of Conduct

This project adheres to the Contributor Covenant Code of Conduct. By participating, you are expected to uphold this code. Please read [CODE_OF_CONDUCT.md](./CODE_OF_CONDUCT.md) before contributing.

---

## Getting Started

### Prerequisites

- Node.js >= 18
- PostgreSQL >= 14
- Git

### Setup Development Environment

```bash
# Clone repository
git clone https://github.com/liu-purnomo/server.liupurnomo.com.git
cd server.liupurnomo.com

# Install dependencies
npm install

# Setup environment
cp .env.example .env

# Setup database
npx prisma generate
npx prisma migrate dev

# Start development server
npm run dev
```

---

## Development Workflow

### 1. Create a Branch

```bash
# For new features
git checkout -b feature/feature-name

# For bug fixes
git checkout -b fix/bug-description

# For documentation
git checkout -b docs/update-description
```

### 2. Make Changes

- Write clean, readable code
- Follow existing code style
- Add tests for new features
- Update documentation as needed

### 3. Test Your Changes

```bash
# Run tests
npm test

# Run linter
npm run lint

# Check types
npm run type-check

# Build project
npm run build
```

---

## Commit Convention

We follow **Conventional Commits** specification for clear and structured commit messages.

### Format

```
<type>(<scope>): <subject>

[optional body]

[optional footer]
```

### Types

| Type | Description | Example |
|------|-------------|---------|
| `feat` | New feature | `feat(auth): add OAuth2 login support` |
| `fix` | Bug fix | `fix(api): resolve null pointer in user service` |
| `docs` | Documentation changes | `docs(readme): update installation steps` |
| `style` | Code style changes (formatting, semicolons, etc.) | `style: format code with prettier` |
| `refactor` | Code refactoring without changing functionality | `refactor(auth): simplify token validation logic` |
| `perf` | Performance improvements | `perf(db): optimize user query with indexes` |
| `test` | Adding or updating tests | `test(user): add unit tests for user service` |
| `build` | Build system or dependencies changes | `build: update prisma to v6.2.0` |
| `ci` | CI/CD configuration changes | `ci: add GitHub Actions workflow` |
| `chore` | Maintenance tasks | `chore: update dependencies` |
| `revert` | Revert previous commit | `revert: revert feat(auth): add OAuth2` |

### Scope (Optional)

Scope specifies the area of change:
- `auth` - Authentication
- `user` - User management
- `post` - Blog posts
- `comment` - Comments
- `media` - Media handling
- `db` - Database
- `api` - API endpoints
- `config` - Configuration

### Subject

- Use imperative mood: "add" not "added" or "adds"
- No capitalization of first letter
- No period (.) at the end
- Maximum 72 characters

### Examples

**Good Commits:**
```bash
feat(auth): add email verification flow
fix(post): resolve slug generation for special characters
docs(api): update authentication endpoint examples
refactor(user): extract validation logic to separate service
perf(db): add index on post slug for faster lookups
test(comment): add integration tests for nested comments
```

**Bad Commits:**
```bash
# Too vague
fix: bug fix

# Not imperative
feat: Added new feature

# Too long
feat(user): add a new user registration feature with email verification and password strength validation and...

# Contains AI attribution
feat: add feature (generated by Claude)
```

---

## Deployment Checklist

Follow these steps **IN ORDER** before pushing to GitHub:

### Step 1: Review Changes

```bash
# Check what files changed
git status

# Review detailed changes
git diff

# View summary of changes
git diff --stat
```

### Step 2: Update Documentation

#### CHANGELOG.md
- Add new entry: `## [X.X.X] - YYYY-MM-DD`
- Categorize changes:
  - **Added** - New features
  - **Changed** - Changes to existing features
  - **Fixed** - Bug fixes
  - **Security** - Security improvements
  - **Deprecated** - Features to be removed
  - **Removed** - Removed features
- Include breaking changes if any
- List new API endpoints

#### README.md
- Update version badge: `[![Version](https://img.shields.io/badge/version-X.X.X-blue.svg)]`
- Add new features to features section if applicable
- Update documentation links if needed

#### Other Documentation
- Update `docs/` folder files if API changes
- Update code examples if behavior changed

### Step 3: Update Version Numbers

#### package.json
**Version Increment Rules:**
- **Patch (X.X.+1)**: Bug fixes, documentation, small improvements
- **Minor (X.+1.0)**: New features, non-breaking changes
- **Major (+1.0.0)**: Breaking changes (avoid during development)

**Development Phase Rule:** Only patch and minor updates allowed

#### src/config/openapi.config.ts
- **MUST** sync version with package.json
- Update description for major feature additions
- Example: `version: '1.10.3'`

### Step 4: Commit and Push

```bash
# Stage all changes
git add .

# Commit with conventional message
git commit -m "feat(auth): add two-factor authentication support"

# Push to remote
git push origin main
```

### Step 5: Verify Deployment

```bash
# Check recent commits
git log --oneline -3

# Verify on GitHub
# Visit: https://github.com/liu-purnomo/server.liupurnomo.com
```

---

## Version Management

### Semantic Versioning

We follow [Semantic Versioning](https://semver.org/): `MAJOR.MINOR.PATCH`

```
0.0.0
│ │ │
│ │ └─── PATCH: Bug fixes, documentation
│ └───── MINOR: New features, backwards compatible
└─────── MAJOR: Breaking changes
```

### When to Increment

**PATCH Version (0.0.X)**
- Bug fixes
- Documentation updates
- Code refactoring (no behavior change)
- Performance improvements
- Security patches

**MINOR Version (0.X.0)**
- New features
- New API endpoints
- Non-breaking enhancements
- Deprecations (with backwards compatibility)

**MAJOR Version (X.0.0)**
- Breaking API changes
- Removal of deprecated features
- Major architecture changes
- **Avoid during active development**

### Files to Sync

Always update these files together:
1. `package.json` → `version`
2. `src/config/openapi.config.ts` → `info.version`
3. `README.md` → Version badge
4. `CHANGELOG.md` → New version entry

---

## Quick Reference

### Pre-Push Checklist

```markdown
- [ ] Code tested and working
- [ ] Tests passing (`npm test`)
- [ ] Linter passing (`npm run lint`)
- [ ] CHANGELOG.md updated
- [ ] README.md updated (if needed)
- [ ] package.json version updated
- [ ] openapi.config.ts version synced
- [ ] Conventional commit message written
- [ ] Changes pushed to GitHub
```

### Common Commands

```bash
# Development
npm run dev                    # Start dev server
npm run build                  # Build for production
npm test                       # Run tests
npm run lint                   # Check code style

# Database
npm run db:migrate             # Run migrations
npm run db:studio              # Open Prisma Studio
npm run db:seed                # Seed database

# Git
git status                     # Check changes
git diff                       # View detailed changes
git log --oneline -10          # View recent commits
```

### Commit Message Template

```bash
# Feature
git commit -m "feat(scope): add new feature description"

# Bug Fix
git commit -m "fix(scope): resolve specific bug description"

# Documentation
git commit -m "docs(scope): update documentation description"

# Refactor
git commit -m "refactor(scope): improve code structure description"
```

---

## Important Rules

1. **Always sync versions** between package.json and openapi.config.ts
2. **Never commit** without updating CHANGELOG.md
3. **Use English** for all code, comments, and documentation
4. **Follow conventional commits** for all commit messages
5. **No AI attribution** in commit messages
6. **Test before commit** - ensure code works
7. **Review your changes** before pushing
8. **No major version bumps** during development phase

---

## Getting Help

If you need help or have questions:

- **Email:** [liu@drone.co.id](mailto:liu@drone.co.id)
- **Issues:** [GitHub Issues](https://github.com/liu-purnomo/server.liupurnomo.com/issues)
- **Discussions:** [GitHub Discussions](https://github.com/liu-purnomo/server.liupurnomo.com/discussions)

---

## License

By contributing to this project, you agree that your contributions will be licensed under the MIT License.

---

Thank you for contributing to Liu Purnomo Blog API!
